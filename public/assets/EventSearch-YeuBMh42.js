import{d as ae,u as he,r as k,b as M,E as ve,G as U,H as C,I as W,e as _e,g as be,f as we,J as K,c as D,o as b,i as X,K as L,a as c,l as d,w as m,p as A,j as h,L as Y,T as ke,_ as De,D as Fe,n as w,M as se,N as le,F as V,s as R,t as F,O as $,P as Se,Q as B,S as Te,U as re,k as Ce,V as oe,R as ne,y as Le,z as Ae,B as Re}from"./index-_XPL6189.js";import{g as qe}from"./global-CHPXcsDF.js";import{C as ie}from"./CustomCardWithSkeleton-CgqGLTOe.js";import{f as Pe}from"./free-tag-CwOw4fTB.js";const Ee=["for"],Oe={class:"relative pb-5 sm:pb-7 md:pb-10 lg:pb-12 flex flex-col"},je={class:"w-[93%] phone:w-[96%] md:w-[97%] xl:w-[98%] mx-auto flex flex-col"},Ne={class:"relative"},ze={class:"flex items-center justify-end sm:justify-between"},Ie={class:"flex-1 phone:flex-initial flex gap-2 lg:gap-3"},Ve={key:0,class:"!m-0"},$e={class:"flex gap-3 mt-1 lg:mt-2 xl:mt-3"},Be={class:"w-full p-3.75 lg:p-4.75 xl:px-6.75 xl:py-4.75 mx-auto flex flex-col"},Je=["src","onLoad","onError"],Ge=["src"],He={class:"flex flex-col gap-0"},Me={class:"text-xs sm:text-sm lg:text-base xl:text-lg"},Ue={class:"skeleton-wrapper flex flex-col items-center"},We={class:"w-full p-3.75 lg:p-4.75 xl:px-6.75 xl:py-4.75 mx-auto flex flex-col"},Ke={class:"flex-1 flex flex-col"},Xe=ae({__name:"EventSearch",setup(Ye){const v=be(),{reqData:q}=we(),P=he(),Z=k(null),Q=k(null),a=M({fetchData:[],total_items:0,past_events:null,reviews:null,isFormLoading:!1,isFirstLoad:!0,next_cursor:null,has_more:!1,hydratedSR:!1,hydratedER:!1}),J=k([]),de=k([{name:"Free",value:"free"},{name:"All",value:"all"},{name:"Pay",value:"pay"}]);let E={pay:["pay","free","all"],category:[],dates:null};const f=M({search:"",category:[],pay:"",dates:[new Date,new Date]}),u=M({search:"",category:[],pay:"",dates:[new Date,new Date]}),_=k(!1),O=k(null),g=ve(()=>a.isFirstLoad||a.isFormLoading?"loading":!a.isFirstLoad&&a.fetchData.length===0?(_.value=!1,"empty"):a.total_items>0?"success":"initial"),j=async()=>{await W(),C.value?O.value=Z.value:(se.value||le.value)&&_.value&&(O.value=Q.value)};let ee=null,N=null,z=null,G={};U(C,()=>{C.value&&_.value&&(_.value=!1)}),U([_,C],j,{immediate:!0}),U(()=>({category:u.category,dates:u.dates,pay:u.pay}),async(t,e)=>{if(a.isFirstLoad)return;const o=Object.keys(t);JSON.stringify(t.dates)!==JSON.stringify(e.dates)&&(a.hydratedSR?a.hydratedER||(a.hydratedER=!0):a.hydratedSR=!0);for(const s of o)if(JSON.stringify(t[s])!==JSON.stringify(e[s])){G[s]&&clearTimeout(G[s]);const i=s==="dates"?750:500;G[s]=setTimeout(async()=>{await H(),s==="category"?f.category=[...u.category]:s==="pay"?f.pay=u.pay:s==="dates"&&(f.dates=u.dates),await W()},i)}},{deep:!0});const ce=k(""),ue=(t,e)=>{const o=E[t];return typeof e=="string"?o.includes(e)?e:"":Array.isArray(e)?e.filter(s=>typeof s=="string"&&o.includes(s))??null:null},pe=t=>{const e={search:t.find,category:Array.isArray(t.f_category)?t.f_category:t.f_category?[t.f_category]:[],pay:t.f_pay,start_date:t.f_sr_date,end_date:t.f_er_date},o={};a.isFirstLoad||(o.search=Array.isArray(e.search)?e.search[0]:e.search??""),a.hydratedSR="f_sr_date"in t,a.hydratedER="f_er_date"in t;for(const n of Object.keys(E)){if(n==="dates"){let i=e.start_date?new Date(e.start_date):null,l=e.end_date?new Date(e.end_date):null;i&&!l&&(l=i),!i&&l&&(i=new Date),!i&&!l&&(i=new Date,l=new Date),o.dates=[i,l];continue}const s=e[n];o[n]=ue(n,s)??(n==="category"?[]:n==="pay"?"":null)}return o},te=t=>{const e=s=>{const i=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),x=String(s.getDate()).padStart(2,"0");return`${i}-${l}-${x}`},o={find:t.search||null,f_category:Array.isArray(t.category)&&t.category.length>0?t.category:null,f_pay:t.pay||null,f_sr_date:a.hydratedSR&&t.dates?.[0]?e(t.dates[0]):null,f_er_date:a.hydratedER&&t.dates?.[1]?e(t.dates[1]):null},n={};for(const s in o){const i=o[s];i&&(n[s]=i)}return n};_e(async()=>{const t={};v.query.find&&(t.find=Array.isArray(v.query.find)?v.query.find[0]:v.query.find,f.search=t.find,u.search=t.find),ee=new AbortController;const e=await q({url:"/api/event-categories",method:"POST",signal:ee.signal,reqType:"Json"});if(e.status=="error"){P.add({severity:"error",summary:"Gagal Ambil Data Kategori",detail:e.message,group:"br",life:3e3});return}e.data.forEach((l,x)=>{l.event_group_name&&l.event_group&&l.event_group_name!=""&&l.event_group!=""&&(J.value=[...J.value,{label:l.event_group_name,value:l.event_group}],E.category=[...E.category,l.event_group])});const o=pe(v.query);Object.assign(t,{...te(o)});const{next_page:n}=v.query;v.query.find&&v.query.find!=""&&(t.limit=15);const s={};if(n&&typeof n=="string"){const l=parseInt(n.replace(/\D/g,""),10);n.length<=100&&!isNaN(l)&&(s["X-Pagination-From"]="first-time",t.next_page=n)}K.replace({path:"/search",query:t}).catch(()=>{}),Object.keys(t).length>0&&(Object.assign(f,{...o,category:o.category?[...o.category]:[]}),Object.assign(u,{...o,category:o.category?[...o.category]:[]})),z=new AbortController;const i=await q({url:"/api/search",method:"POST",headers:s,signal:z.signal,reqType:"Json",includeQuery:t,callbackFinalFn:{isRoute:l=>l=="/search",fn:async()=>await j()}});if(i.status=="error"){P.add({severity:"error",summary:"Gagal Ambil Data Halaman",detail:i.message,group:"br",life:3e3});return}a.fetchData=i.data.data,a.total_items=i.data.total_items,a.next_cursor=i.data.next_cursor,a.has_more=i.data.has_more,await W(),a.isFirstLoad=!1});const H=async()=>{N&&N.abort();let t=!1;const e=(s,i)=>{const l=re(s),x=re(i);return Array.isArray(l)&&Array.isArray(x)?l.length!==x.length?!1:l.every(p=>p instanceof Date)&&x.every(p=>p instanceof Date)?l.every((p,S)=>p.getTime()===x[S].getTime()):l.every((p,S)=>p===x[S]):l===x};for(const s of Object.keys(f))if(!e(f[s],u[s])){t=!0;break}if(!t)return;a.total_items=0,N=new AbortController;const o=te(u);u.search!=""&&(o.limit=15),K.push({path:"/search",query:o}),a.isFormLoading=!0,f.search=u.search;const n=await q({url:"/api/search",method:"POST",signal:N.signal,reqType:"Json",includeQuery:o,callbackFinalFn:{isRoute:s=>s=="/search",fn:async()=>await j()}});if(a.isFormLoading=!1,ce.value=u.search,n.status=="error"){P.add({severity:"error",summary:"Gagal Ambil Data Halaman",detail:n.message,group:"br",life:3e3});return}a.fetchData=n.data.data,a.total_items=n.data.total_items,a.has_more=n.data.has_more,a.next_cursor=n.data.next_cursor},me=async()=>{if(!a.has_more)return;await K.replace({path:"/search",query:{...v.query,next_page:a.next_cursor,limit:15}}),z=new AbortController;const t=await q({url:"/api/search",method:"POST",signal:z.signal,reqType:"Json",includeQuery:v.query,callbackFinalFn:{isRoute:e=>e=="/search",fn:async()=>await j()}});if(t.status=="error"){P.add({severity:"error",summary:"Gagal Ambil Data Halaman",detail:t.message,group:"br",life:3e3});return}a.fetchData.push(...t.data.data),a.next_cursor=t.data.next_cursor,a.has_more=t.data.has_more},ge={wrapper:t=>ae({setup(){const e=Le();return()=>Ae(ne,{to:t.event_id,class:"relative"},{default:()=>e.default?e.default():null})}}),customTWGrand:"flex-1",customTWTransition:"grid grid-cols-1 phone:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-3 sm:gap-4 lg:gap-5",pagination:{customTWPaginator:"!mt-3 !sm:mt-4 lg:!mt-5",lazyLoading:!0,preRenderPage:1,item_id:"event_id"},snapshots:{base:5,md:4,xl:3}},xe={customTWTransition:"flex-1 grid grid-cols-1 phone:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-3 sm:gap-4 lg:gap-5",snapshots:{base:5,md:4,xl:3}};return(t,e)=>{const o=w("Checkbox"),n=w("CheckboxGroup"),s=w("DatePicker"),i=w("Select"),l=w("InputText"),x=w("Button"),p=w("Skeleton"),S=w("Card"),fe=w("Dialog");return b(),D(V,null,[O.value?(b(),X(ke,{key:0,to:O.value,defer:""},[d(h(Y),{class:A(["flex flex-col",{"pointer-events-none":a.isFirstLoad}])},{default:m(()=>[e[9]||(e[9]=c("label",null,"Pilih Kategori",-1)),d(n,{name:"ingredient",class:"flex flex-col gap-4","model-value":u.category,"onUpdate:modelValue":e[0]||(e[0]=r=>u.category=r)},{default:m(()=>[(b(!0),D(V,null,Ce(J.value,(r,y)=>(b(),D("div",{key:r.value,class:"flex items-center gap-2"},[d(o,{inputId:"cat"+y,value:r.value},null,8,["inputId","value"]),c("label",{for:"cat"+y},F(r.label),9,Ee)]))),128))]),_:1},8,["model-value"])]),_:1},8,["class"]),d(h(Y),{class:A(["flex flex-col",{"pointer-events-none":a.isFirstLoad}])},{default:m(()=>[e[10]||(e[10]=c("label",{class:"ml-1"},"Pilih Rentang Tanggal",-1)),d(s,{modelValue:u.dates,"onUpdate:modelValue":e[1]||(e[1]=r=>u.dates=r),selectionMode:"range",dateFormat:"dd/mm/yy"},null,8,["modelValue"])]),_:1},8,["class"]),d(h(Y),{class:A(["flex flex-col",{"pointer-events-none":a.isFirstLoad}])},{default:m(()=>[e[11]||(e[11]=c("label",{class:"ml-1"},"Free ?",-1)),d(i,{"model-value":u.pay,"onUpdate:modelValue":e[2]||(e[2]=r=>u.pay=r),options:de.value,optionLabel:"name",optionValue:"value",placeholder:"Select event fee",class:"w-full"},null,8,["model-value","options"])]),_:1},8,["class"])],8,["to"])):L("",!0),e[16]||(e[16]=c("img",{src:De,alt:"",class:"absolute bottom-0 md:-bottom-5 -right-13 sm:-right-23 md:-right-32 lg:-right-35 xl:-right-35 2xl:-right-37 h-57 xs:h-62 phone:h-65 sm:h-90 md:h-130 lg:h-132 xl:h-137 2xl:h-145 -z-1 object-contain opacity-30 scale-300 sm:scale-270 md:scale-250"},null,-1)),c("section",Oe,[c("div",je,[c("div",Ne,[c("div",ze,[e[14]||(e[14]=c("h2",{class:"!m-0 w-fit hidden sm:block text-4xl"},"Search Events",-1)),c("div",Ie,[d(l,{id:"email",type:"email",class:A(["flex-1 sm:flex-initial sm:w-55 md:w-60 lg:w-[calc(0.25rem*65)] xl:w-70",{"pointer-events-none":a.isFirstLoad}]),placeholder:"Cari Event",modelValue:u.search,"onUpdate:modelValue":e[3]||(e[3]=r=>u.search=r),onKeyup:e[4]||(e[4]=Fe(r=>H(),["enter"]))},null,8,["class","modelValue"]),d(x,{class:"!px-1.75 rounded-md",onClick:e[5]||(e[5]=r=>H())},{default:m(()=>[...e[12]||(e[12]=[R("Search",-1)])]),_:1}),h(se)||h(le)?(b(),X(x,{key:0,class:A(["!px-1.75 rounded-md",{"pointer-events-none":g.value!="loading"&&f.search==""||g.value=="empty"}]),onClick:e[6]||(e[6]=r=>_.value=!0)},{default:m(()=>[...e[13]||(e[13]=[R("Filters",-1)])]),_:1},8,["class"])):L("",!0)])]),(g.value=="initial"||g.value=="loading"||g.value=="success")&&f.search!=""?(b(),D("p",Ve,[g.value=="initial"||g.value=="loading"?(b(),D(V,{key:0},[R(' Sedang mencari event "'+F(f.search)+'"... ',1)],64)):g.value=="success"?(b(),D(V,{key:1},[R(' Menampilkan Event "'+F(f.search)+'" menemukan '+F(a.total_items),1)],64)):L("",!0)])):L("",!0)]),c("div",$e,[d(Se,{name:"sidefilter",appear:""},{default:m(()=>[h(C)?$((b(),X(h(oe),{key:0,ref:r=>Z.value=r?.$el,class:"sticky w-70 h-fit rounded-xl flex flex-col gap-2 pt-3 pb-5 pl-5 pr-5",style:{"background-color":"#fff","box-shadow":"0px 18px 47px 0px rgba(0, 0, 0, 0.1)",top:"calc(var(--paddTop) + 10px)"}},null,512)),[[B,g.value=="initial"||g.value=="loading"||g.value=="success"]]):L("",!0)]),_:1}),$(d(ie,{metaData:ge,inpData:a.fetchData,paralelRender:4,onLazyData:me},{skeleton:m(({index:r,skeletonRefs:y})=>[c("div",{ref:T=>y[r]=T,class:"skeleton-wrapper absolute z-10 left-0 w-full h-full flex flex-col items-center transition-opacity duration-100 pointer-events-none"},[d(p,{pt:{root:{class:["!w-[103%] sm:!w-[102.5%] !h-[123px] phone:!h-[172px] lg:!h-[200px] !rounded-lg relative -left-[0.25%] -top-[1%]"],style:"background-color: rgba(0,0,0, 0.18)"}}}),c("div",Be,[d(p,{pt:{root:{class:["!h-[13px] sm:!h-[16.75px] lg:!h-[17px] xl:!h-[18px] 2xl:!h-[20px] !rounded-[3px] sm:!rounded-[4px] lg:!rounded-[5px]"],style:"background-color: rgba(0,0,0, 0.18)"}}}),d(p,{pt:{root:{class:["!h-[13px] sm:!h-[16.75px] lg:!h-[17px] xl:!h-[18px] 2xl:!h-[20px] mt-1 lg:mt-1.5 !rounded-[3px] sm:!rounded-[4px] lg:!rounded-[5px]"],style:"background-color: rgba(0,0,0, 0.18)"}}}),d(p,{pt:{root:{class:["!w-[92px] xs:!w-[92px] phone:!w-[110px] sm:!w-[112px] lg:!w-[127px] xl:!w-[157px] 2xl:!w-[160px] !h-[14px] sm:!h-[15.5px] lg:!h-[18px] xl:!h-[18px] 2xl:!h-[20px] mt-1.5 sm:mt-1 lg:mt-2 !rounded-[3px] sm:!rounded-[4px] lg:!rounded-[5px]"],style:"background-color: rgba(0,0,0, 0.18)"}}})])],512)]),card:m(({index:r,inpData:y,toggleSkeleton:T,cardRefs:ye})=>[d(S,{ref:I=>ye[r]=I?.$el,pt:{root:{class:["!h-full rounded-md lg:rounded-[20px] overflow-hidden opacity-0 transition-opacity duration-100"],style:"box-shadow: 0px 18px 47px 0px rgba(0, 0, 0, 0.1);"},body:{class:["!p-4 lg:!p-5 xl:!px-7 xl:!py-5"]}}},{header:m(()=>[c("img",{src:h(qe)(y.img),alt:"",class:"w-full h-[120px] phone:h-[170px] lg:h-[197px] object-cover",ref:(I=>{I?.complete&&I.naturalWidth!==0&&!y.imgLoad&&T(r)}),onLoad:()=>{y.imgLoad=!0,T(r)},onError:()=>T(r)},null,40,Je),c("img",{src:h(Pe),alt:"",class:"absolute -top-0.5 -right-0.5 z-9 h-[17%] lg:h-[20%]"},null,8,Ge)]),content:m(()=>[c("div",He,[d(h(ne),{to:"/event/"+y.event_id,class:"min-h-[3em] text-sm sm:text-base lg:text-lg xl:text-xl font:medium line-clamp-2 leading-snug"},{default:m(()=>[R(F(y.event_name),1)]),_:2},1032,["to"]),c("span",Me,F(y.start_date),1)])]),_:2},1536)]),_:1},8,["inpData"]),[[B,g.value=="success"]]),$(d(ie,{metaData:xe,paralelRender:1/0,isLoading:!0},{default:m(()=>[c("div",Ue,[d(p,{pt:{root:{class:["!w-[103%] sm:!w-[102.5%] !h-[123px] phone:!h-[172px] lg:!h-[200px] !rounded-lg relative -left-[0.25%] -top-[1%]"],style:"background-color: rgba(0,0,0, 0.18)"}}}),c("div",We,[d(p,{pt:{root:{class:["!h-[13px] sm:!h-[16.75px] lg:!h-[17px] xl:!h-[18px] 2xl:!h-[20px] !rounded-[3px] sm:!rounded-[4px] lg:!rounded-[5px]"],style:"background-color: rgba(0,0,0, 0.18)"}}}),d(p,{pt:{root:{class:["!h-[13px] sm:!h-[16.75px] lg:!h-[17px] xl:!h-[18px] 2xl:!h-[20px] mt-1 lg:mt-1.5 !rounded-[3px] sm:!rounded-[4px] lg:!rounded-[5px]"],style:"background-color: rgba(0,0,0, 0.18)"}}}),d(p,{pt:{root:{class:["!w-[92px] xs:!w-[92px] phone:!w-[110px] sm:!w-[112px] lg:!w-[127px] xl:!w-[157px] 2xl:!w-[160px] !h-[14px] sm:!h-[15.5px] lg:!h-[18px] xl:!h-[18px] 2xl:!h-[20px] mt-1.5 sm:mt-1 lg:mt-2 !rounded-[3px] sm:!rounded-[4px] lg:!rounded-[5px]"],style:"background-color: rgba(0,0,0, 0.18)"}}})])])]),_:1},512),[[B,a.isFormLoading||a.isFirstLoad]]),$(c("div",Ke,[...e[15]||(e[15]=[c("div",{class:"lg:w-[75%] xl:w-[65%] 2xlw-[60%] flex flex-col lg:flex-row justify-between items-center mx-auto my-auto gap-2.5 sm:gap-3 md:gap-5 lg:gap-0"},[c("img",{src:Te,alt:"",class:"w-[67%] xs:w-[57%] sm:w-[65%] md:w-[77%] lg:w-[65%] xl:w-[58%] 2xl:w-[55%] object-cover"}),c("h3",{class:"!m-0 !text-xl phone:!text-2xl sm:!text-3xl md:!text-4xl lg:!text-5xl 2xl:!text-6xl !text-center !text-red-500"},"Event Tidak Ditemukan")],-1)])],512),[[B,g.value=="empty"]])])])]),d(fe,{visible:_.value,"onUpdate:visible":e[8]||(e[8]=r=>_.value=r),class:"w-[70%] xs:w-[230px] phone:w-[300px]",header:"Filter Details","pt:mask:class":"backdrop-blur-sm",modal:"",dismissableMask:""},{footer:m(()=>[d(x,{label:"Close",icon:"pi pi-times",text:"",onClick:e[7]||(e[7]=r=>_.value=!1)})]),default:m(()=>[d(h(oe),{ref:r=>Q.value=r?.$el,class:"flex flex-col gap-3"},null,512)]),_:1},8,["visible"])],64)}}}),at=Re(Xe,[["__scopeId","data-v-e56cf947"]]);export{at as default};
